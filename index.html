<!DOCTYPE html>

<html lang="ru">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>CityFlow ‚Äî –ê–∫–∏–º–∞—Ç –≥–æ—Ä–æ–¥–∞ –°–µ–º–µ–π</title>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>

        /* --- CORE STYLES (EGOV STYLE) --- */

        :root {

            --primary-blue: #005baa; /* eGov Blue */

            --primary-dark: #004a8b;

            --secondary-bg: #f2f4f7;

            --white: #ffffff;

            --text-main: #333333;

            --text-light: #7f8c8d;

            --ai-accent: #6c5ce7; /* –¶–≤–µ—Ç AI –º–æ–¥—É–ª–µ–π */

            --success: #27ae60;

            --warning: #f39c12;

            --danger: #e74c3c;

            --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.08);

        }



        body {

            margin: 0;

            font-family: 'Roboto', 'Segoe UI', sans-serif;

            background-color: var(--secondary-bg);

            color: var(--text-main);

            -webkit-font-smoothing: antialiased;

        }



        /* --- HEADER & NAVIGATION --- */

        header {

            background: var(--white);

            height: 70px;

            display: flex;

            align-items: center;

            justify-content: space-between;

            padding: 0 5%;

            border-bottom: 3px solid var(--primary-blue);

            box-shadow: 0 2px 5px rgba(0,0,0,0.05);

            position: sticky;

            top: 0;

            z-index: 1000;

        }



        .brand {

            display: flex;

            align-items: center;

            gap: 15px;

        }



        .brand img {

            height: 50px;

            width: auto;

        }



        .brand-text {

            display: flex;

            flex-direction: column;

        }



        .brand-title {

            font-size: 20px;

            font-weight: 700;

            color: var(--primary-blue);

            text-transform: uppercase;

            letter-spacing: 0.5px;

        }



        .brand-subtitle {

            font-size: 11px;

            color: var(--text-light);

            font-weight: 500;

        }



        .user-panel {

            display: flex;

            align-items: center;

            gap: 15px;

        }



        .btn-logout {

            background: transparent;

            border: 1px solid var(--danger);

            color: var(--danger);

            padding: 8px 16px;

            border-radius: 4px;

            cursor: pointer;

            font-size: 13px;

            transition: all 0.2s;

        }



        .btn-logout:hover {

            background: var(--danger);

            color: var(--white);

        }



        /* --- LAYOUT & CARDS --- */

        .main-container {

            max-width: 1000px;

            margin: 30px auto;

            padding: 0 20px;

            min-height: 80vh;

        }



        .card {

            background: var(--white);

            border-radius: 8px;

            padding: 30px;

            margin-bottom: 25px;

            box-shadow: var(--shadow-card);

            border-top: 4px solid transparent;

            animation: fadeIn 0.4s ease-in-out;

        }



        .card-citizen { border-top-color: var(--primary-blue); }

        .card-admin { border-top-color: var(--warning); }

        .card-worker { border-top-color: var(--ai-accent); }



        @keyframes fadeIn {

            from { opacity: 0; transform: translateY(10px); }

            to { opacity: 1; transform: translateY(0); }

        }



        h2 { margin-top: 0; color: var(--primary-blue); font-weight: 600; }

        h3 { font-size: 16px; color: var(--text-main); margin-bottom: 15px; font-weight: 600; }



        /* --- FORMS --- */

        .form-group { margin-bottom: 20px; }



        label {

            display: block;

            margin-bottom: 8px;

            font-size: 13px;

            color: var(--text-light);

            font-weight: 500;

        }



        input, select, textarea {

            width: 100%;

            padding: 12px 15px;

            border: 1px solid #dce1e6;

            border-radius: 4px;

            font-size: 14px;

            color: var(--text-main);

            box-sizing: border-box;

            transition: border-color 0.2s;

            background: #fafafa;

        }



        input:focus, textarea:focus {

            border-color: var(--primary-blue);

            background: var(--white);

            outline: none;

        }



        .btn-primary {

            background: var(--primary-blue);

            color: var(--white);

            border: none;

            padding: 12px 30px;

            border-radius: 4px;

            font-weight: 500;

            cursor: pointer;

            font-size: 15px;

            transition: background 0.2s;

            width: 100%;

        }



        .btn-primary:hover { background: var(--primary-dark); }



        /* --- AI MODULES (DECOR & FUNCTION) --- */

        .ai-panel {

            background: #f8f9fe;

            border: 1px dashed var(--ai-accent);

            border-radius: 6px;

            padding: 15px;

            margin-top: 15px;

            position: relative;

        }



        .ai-badge {

            position: absolute;

            top: -10px;

            right: 15px;

            background: var(--ai-accent);

            color: white;

            font-size: 10px;

            font-weight: bold;

            padding: 4px 10px;

            border-radius: 12px;

            box-shadow: 0 2px 5px rgba(108, 92, 231, 0.3);

        }



        .ai-content {

            font-size: 13px;

            color: #4a4a4a;

            line-height: 1.5;

        }



        .ai-loading {

            display: inline-block;

            width: 10px;

            height: 10px;

            border: 2px solid var(--ai-accent);

            border-radius: 50%;

            border-top-color: transparent;

            animation: spin 1s linear infinite;

            margin-right: 8px;

        }



        @keyframes spin { to { transform: rotate(360deg); } }



        /* --- UTILS --- */

        .hidden { display: none !important; }

        

        .status-badge {

            padding: 5px 10px;

            border-radius: 4px;

            font-size: 11px;

            font-weight: 700;

            text-transform: uppercase;

        }

        .st-new { background: #eee; color: #777; }

        .st-process { background: #fff3cd; color: #856404; }

        .st-done { background: #d4edda; color: #155724; }

        .st-reject { background: #f8d7da; color: #721c24; }



        .req-photo {

            width: 100%;

            max-height: 300px;

            object-fit: cover;

            border-radius: 6px;

            margin-top: 10px;

            border: 1px solid #eee;

        }

    </style>

</head>

<body>



<header>

    <div class="brand">

        <img src="logo.png" alt="CityFlow Logo" onerror="this.style.display='none'">

        <div class="brand-text">

            <span class="brand-title">CityFlow</span>

            <span class="brand-subtitle">–¶–∏—Ñ—Ä–æ–≤–æ–π –ê–∫–∏–º–∞—Ç –≥. –°–µ–º–µ–π</span>

        </div>

    </div>

    <div class="user-panel hidden" id="userPanel">

        <span id="userNameDisplay" style="font-size:14px; font-weight:500; margin-right:10px;"></span>

        <button class="btn-logout" onclick="App.logout()">–í—ã–π—Ç–∏</button>

    </div>

</header>



<div class="main-container">



    <div id="view-login" class="card">

        <div style="text-align: center; margin-bottom: 30px;">

            <h2 style="color:var(--text-main)">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>

            <p style="color:var(--text-light)">–ï–¥–∏–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π</p>

        </div>

        <div class="form-group">

            <label>–ò–ò–ù (–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä)</label>

            <input type="text" id="login-iin" placeholder="–í–≤–µ–¥–∏—Ç–µ 12 —Ü–∏—Ñ—Ä" maxlength="12">

        </div>

        <div class="form-group">

            <label>–§–ò–û</label>

            <input type="text" id="login-name" placeholder="–ü—Ä–∏–º–µ—Ä: –û–º–∞—Ä–æ–≤ –°–µ—Ä–∏–∫">

        </div>

        <button class="btn-primary" onclick="App.login()">–í–æ–π—Ç–∏</button>

        <div style="margin-top:20px; font-size:11px; color:#aaa; text-align:center;">

            *–î–ª—è —Å–ª—É–∂–µ–±–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü. –ò–ò–ù

        </div>

    </div>



    <div id="view-citizen" class="hidden">

        <div class="card card-citizen">

            <h2>–ü–æ–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ</h2>

            <div class="form-group">

                <label>–ê–¥—Ä–µ—Å –ø—Ä–æ–±–ª–µ–º—ã (–≥. –°–µ–º–µ–π)</label>

                <input id="req-address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ...">

            </div>

            <div class="form-group">

                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>

                <select id="req-category">

                    <option value="roads">–î–æ—Ä–æ–≥–∏ –∏ —è–º—ã</option>

                    <option value="lights">–û—Å–≤–µ—â–µ–Ω–∏–µ</option>

                    <option value="trash">–í—ã–≤–æ–∑ –º—É—Å–æ—Ä–∞</option>

                    <option value="water">–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ</option>

                    <option value="other">–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</option>

                </select>

            </div>

            <div class="form-group">

                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>

                <textarea id="req-desc" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥—Ä–æ–±–Ω–æ..."></textarea>

            </div>

            <div class="form-group">

                <label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>

                <input type="file" id="req-photo" accept="image/*">

            </div>

            <button class="btn-primary" onclick="App.createRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –ê–∫–∏–º–∞—Ç</button>

        </div>



        <h3>–ò—Å—Ç–æ—Ä–∏—è –º–æ–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π</h3>

        <div id="citizen-history"></div>

    </div>



    <div id="view-admin" class="hidden">

        <div class="card card-admin">

            <h2>–ü–∞–Ω–µ–ª—å –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–ê–∫–∏–º–∞—Ç)</h2>

            <div style="display:flex; gap:20px; margin-bottom:20px;">

                <div style="flex:1; background:#f0f8ff; padding:15px; border-radius:6px; text-align:center;">

                    <b id="stat-total" style="font-size:24px; color:var(--primary-blue)">0</b><br>

                    <span style="font-size:12px">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</span>

                </div>

                <div style="flex:1; background:#fff5f5; padding:15px; border-radius:6px; text-align:center;">

                    <b id="stat-pending" style="font-size:24px; color:var(--danger)">0</b><br>

                    <span style="font-size:12px">–¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</span>

                </div>

            </div>

        </div>

        <div id="admin-feed"></div>

    </div>



    <div id="view-worker" class="hidden">

        <div class="card card-worker">

            <h2>–ö–∞–±–∏–Ω–µ—Ç –ü–æ–¥—Ä—è–¥—á–∏–∫–∞</h2>

            <p>–î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞—Ä—è–¥—ã –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç (–≥. –°–µ–º–µ–π)</p>

        </div>

        <div id="worker-feed"></div>

    </div>



</div>



<script>

    /**

     * CityFlow Engine

     * Developed for Semey City Administration context.

     * Contains mocked AI logic and local storage persistence.

     */

    

    const App = {

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π

        roles: {

            ADMIN: '999999999999',

            WORKER: '222222222222'

        },



        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

        init: function() {

            this.checkSession();

        },



        // --- AUTHENTICATION ---

        login: function() {

            const iin = document.getElementById('login-iin').value.trim();

            const name = document.getElementById('login-name').value.trim();



            if (iin.length !== 12) {

                alert('–û—à–∏–±–∫–∞: –ò–ò–ù –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 12 —Ü–∏—Ñ—Ä.');

                return;

            }

            if (!name) {

                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è.');

                return;

            }



            let role = 'citizen';

            if (iin === this.roles.ADMIN) role = 'admin';

            if (iin === this.roles.WORKER) role = 'worker';



            const user = { iin, name, role };

            localStorage.setItem('cityflow_user', JSON.stringify(user));

            this.checkSession();

        },



        logout: function() {

            localStorage.removeItem('cityflow_user');

            location.reload();

        },



        checkSession: function() {

            const userStr = localStorage.getItem('cityflow_user');

            if (userStr) {

                this.currentUser = JSON.parse(userStr);

                this.renderUI();

            } else {

                this.showView('view-login');

                document.getElementById('userPanel').classList.add('hidden');

            }

        },



        // --- NAVIGATION ---

        showView: function(viewId) {

            ['view-login', 'view-citizen', 'view-admin', 'view-worker'].forEach(id => {

                document.getElementById(id).classList.add('hidden');

            });

            document.getElementById(viewId).classList.remove('hidden');

        },



        renderUI: function() {

            document.getElementById('userPanel').classList.remove('hidden');

            document.getElementById('userNameDisplay').innerText = 

                `${this.currentUser.name} (${this.getRoleName(this.currentUser.role)})`;



            if (this.currentUser.role === 'citizen') {

                this.showView('view-citizen');

                this.renderCitizenHistory();

            } else if (this.currentUser.role === 'admin') {

                this.showView('view-admin');

                this.renderAdminFeed();

            } else if (this.currentUser.role === 'worker') {

                this.showView('view-worker');

                this.renderWorkerFeed();

            }

        },



        getRoleName: function(role) {

            if (role === 'admin') return '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è';

            if (role === 'worker') return '–ü–æ–¥—Ä—è–¥—á–∏–∫';

            return '–ñ–∏—Ç–µ–ª—å';

        },



        // --- DATA MANAGEMENT ---

        getRequests: function() {

            return JSON.parse(localStorage.getItem('cityflow_db') || '[]');

        },



        saveRequests: function(requests) {

            localStorage.setItem('cityflow_db', JSON.stringify(requests));

        },



        // --- ACTIONS: CITIZEN ---

        createRequest: async function() {

            const address = document.getElementById('req-address').value;

            const category = document.getElementById('req-category').value;

            const desc = document.getElementById('req-desc').value;

            const fileInput = document.getElementById('req-photo');



            if (!address || !desc) {

                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–¥—Ä–µ—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ!');

                return;

            }



            let photoBase64 = null;

            if (fileInput.files[0]) {

                photoBase64 = await this.toBase64(fileInput.files[0]);

            }



            const newReq = {

                id: Date.now(),

                iin: this.currentUser.iin,

                author: this.currentUser.name,

                address,

                category,

                desc,

                photo: photoBase64,

                status: 'new', // new, approved, rejected, completed

                adminComment: '',

                aiLocationData: null, // –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ AI –∞–∫–∏–º–∞—Ç–∞

                workerData: null, // –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ AI –ø–æ–¥—Ä—è–¥—á–∏–∫–∞

                date: new Date().toLocaleDateString('ru-RU')

            };



            const db = this.getRequests();

            db.push(newReq);

            this.saveRequests(db);

            

            alert('–í–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ!');

            document.getElementById('req-desc').value = '';

            document.getElementById('req-address').value = '';

            this.renderCitizenHistory();

        },



        renderCitizenHistory: function() {

            const db = this.getRequests();

            const myReqs = db.filter(r => r.iin === this.currentUser.iin).reverse();

            const container = document.getElementById('citizen-history');

            

            if (myReqs.length === 0) {

                container.innerHTML = '<p style="color:#999; text-align:center">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';

                return;

            }



            container.innerHTML = myReqs.map(r => `

                <div class="card">

                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">

                        <span class="status-badge ${this.getStatusClass(r.status)}">${this.getStatusText(r.status)}</span>

                        <small style="color:#999">${r.date}</small>

                    </div>

                    <h3>${r.category.toUpperCase()}: ${r.address}</h3>

                    <p>${r.desc}</p>

                    ${r.photo ? `<img src="${r.photo}" class="req-photo">` : ''}

                    

                    ${r.adminComment ? `

                        <div class="ai-panel" style="border-color:var(--primary-blue); background:#eef2ff;">

                            <strong>–û—Ç–≤–µ—Ç –ê–∫–∏–º–∞—Ç–∞:</strong><br>

                            ${r.adminComment}

                        </div>

                    ` : ''}

                </div>

            `).join('');

        },



        // --- ACTIONS: ADMIN (AKIMAT) ---

        renderAdminFeed: function() {

            const db = this.getRequests();

            

            // Stats

            document.getElementById('stat-total').innerText = db.length;

            document.getElementById('stat-pending').innerText = db.filter(r => r.status === 'new').length;



            const container = document.getElementById('admin-feed');

            container.innerHTML = db.slice().reverse().map(r => {

                // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã AI –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –µ—â–µ –Ω–µ—Ç

                if (!r.aiLocationData) {

                    r.aiLocationData = this.aiSimulateLocation(r.address);

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º "–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ" –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –º–µ–Ω—è–ª–∏—Å—å

                    this.updateRequestData(r.id, { aiLocationData: r.aiLocationData }, false); 

                }



                return `

                <div class="card">

                    <div style="display:flex; justify-content:space-between">

                        <b>–ó–∞—è–≤–∏—Ç–µ–ª—å: ${r.author} (–ò–ò–ù: ${r.iin})</b>

                        <span class="status-badge ${this.getStatusClass(r.status)}">${this.getStatusText(r.status)}</span>

                    </div>

                    <p style="margin:5px 0; color:#666">${r.address}</p>

                    <p>${r.desc}</p>

                    ${r.photo ? `<img src="${r.photo}" class="req-photo" style="height:150px; width:auto;">` : ''}



                    <div class="ai-panel">

                        <span class="ai-badge">GeoAI Analytics</span>

                        <div class="ai-content">

                            <div><span class="ai-loading"></span>–ê–Ω–∞–ª–∏–∑ –ª–æ–∫–∞—Ü–∏–∏...</div>

                            <div style="margin-top:5px">

                                <b>–†–∞–π–æ–Ω (AI):</b> ${r.aiLocationData.district}<br>

                                <b>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è:</b> ${r.aiLocationData.coords}<br>

                                <b>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</b> <span style="color:${r.aiLocationData.priorityColor}">${r.aiLocationData.priority}</span>

                            </div>

                        </div>

                    </div>



                    <div style="margin-top:15px; border-top:1px solid #eee; padding-top:15px;">

                        <label>–†–µ—à–µ–Ω–∏–µ –ê–∫–∏–º–∞—Ç–∞:</label>

                        <select id="status-${r.id}" style="margin-bottom:10px">

                            <option value="new" ${r.status==='new'?'selected':''}>–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>

                            <option value="approved" ${r.status==='approved'?'selected':''}>–û–¥–æ–±—Ä–∏—Ç—å (–ü–µ—Ä–µ–¥–∞—Ç—å –ø–æ–¥—Ä—è–¥—á–∏–∫—É)</option>

                            <option value="rejected" ${r.status==='rejected'?'selected':''}>–û—Ç–∫–∞–∑–∞—Ç—å</option>

                        </select>

                        <textarea id="comment-${r.id}" placeholder="–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç..." rows="2">${r.adminComment}</textarea>

                        <button class="btn-primary" style="margin-top:10px" onclick="App.adminUpdate(${r.id})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ</button>

                    </div>

                </div>

            `}).join('');

        },



        adminUpdate: function(id) {

            const status = document.getElementById(`status-${id}`).value;

            const comment = document.getElementById(`comment-${id}`).value;

            this.updateRequestData(id, { status, adminComment: comment }, true);

        },



        // --- ACTIONS: WORKER (CONTRACTOR) ---

        renderWorkerFeed: function() {

            const db = this.getRequests();

            // –ü–æ–¥—Ä—è–¥—á–∏–∫ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –û–î–û–ë–†–ï–ù–ù–´–ï –∑–∞—è–≤–∫–∏

            const todoList = db.filter(r => r.status === 'approved');

            const container = document.getElementById('worker-feed');



            if (todoList.length === 0) {

                container.innerHTML = '<p style="text-align:center">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.</p>';

                return;

            }



            container.innerHTML = todoList.map(r => {

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI —Å–º–µ—Ç—ã, –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç

                if (!r.workerData) {

                    r.workerData = this.aiSimulateDamage(r.category);

                    this.updateRequestData(r.id, { workerData: r.workerData }, false);

                }



                return `

                <div class="card card-worker">

                    <h3>–ù–∞—Ä—è–¥ ‚Ññ${r.id} | ${r.category.toUpperCase()}</h3>

                    <p><b>–ê–¥—Ä–µ—Å:</b> ${r.address}</p>

                    <p>${r.desc}</p>

                    ${r.photo ? `<img src="${r.photo}" class="req-photo">` : ''}



                    <div class="ai-panel" style="border-color:#00b894; background:#f0fff4;">

                        <span class="ai-badge" style="background:#00b894">AI Defectoscopy</span>

                        <div class="ai-content">

                            <b>–ê–Ω–∞–ª–∏–∑ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π (AI Vision):</b><br>

                            ‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–∞—è —Ç–µ—Ö–Ω–∏–∫–∞: ${r.workerData.machinery}<br>

                            ‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: ${r.workerData.materials}<br>

                            ‚Ä¢ –ü—Ä–æ–≥–Ω–æ–∑ –±—é–¥–∂–µ—Ç–∞: <b style="font-size:14px">${r.workerData.budget}</b><br>

                            ‚Ä¢ –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${r.workerData.time}

                        </div>

                    </div>



                    <button class="btn-primary" style="background:#27ae60; margin-top:15px" onclick="alert('–ë—Ä–∏–≥–∞–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç!')">–ü—Ä–∏–Ω—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É</button>

                </div>

            `}).join('');

        },



        // --- AI SIMULATION LOGIC ---

        aiSimulateLocation: function(addr) {

            // –ò–º–∏—Ç–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–π–æ–Ω–∞ –≥–æ—Ä–æ–¥–∞ –°–µ–º–µ–π –ø–æ –∞–¥—Ä–µ—Å—É

            const districts = ['–¶–µ–Ω—Ç—Ä', '–ñ–∞–Ω–∞-–°–µ–º–µ–π', '–í–æ—Å—Ç–æ—á–Ω—ã–π', '–ó–∞—Ç–æ–Ω', '–û–∫–µ–∞–Ω', '–¶–µ–º–µ–Ω—Ç–Ω—ã–π –ø–æ—Å–µ–ª–æ–∫'];

            const district = districts[Math.floor(Math.random() * districts.length)];

            const isHighPriority = Math.random() > 0.6;

            

            return {

                district: district,

                coords: `49.${Math.floor(Math.random()*99)}¬∞ N, 80.${Math.floor(Math.random()*99)}¬∞ E`,

                priority: isHighPriority ? '–í–´–°–û–ö–ò–ô (–†—è–¥–æ–º —Å–æ—Ü. –æ–±—ä–µ–∫—Ç—ã)' : '–û–ë–´–ß–ù–´–ô',

                priorityColor: isHighPriority ? '#e74c3c' : '#27ae60'

            };

        },



        aiSimulateDamage: function(cat) {

            // –ò–º–∏—Ç–∞—Ü–∏—è —Å–º–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

            const dict = {

                'roads': { machine: '–ê—Å—Ñ–∞–ª—å—Ç–æ—É–∫–ª–∞–¥—á–∏–∫, –ö–∞—Ç–æ–∫', mat: '–ê—Å—Ñ–∞–ª—å—Ç (4—Ç), –ë–∏—Ç—É–º', budget: '450 000 ‚Ç∏', time: '2 –¥–Ω—è' },

                'lights': { machine: '–ê–≤—Ç–æ–≤—ã—à–∫–∞', mat: 'LED –ª–∞–º–ø–∞ 100W, –ö–∞–±–µ–ª—å 50–º', budget: '85 000 ‚Ç∏', time: '4 —á–∞—Å–∞' },

                'trash': { machine: '–ú—É—Å–æ—Ä–æ–≤–æ–∑ (–ö–ê–ú–ê–ó)', mat: '–ù–µ—Ç', budget: '15 000 ‚Ç∏', time: '1 —á–∞—Å' },

                'water': { machine: '–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä', mat: '–¢—Ä—É–±–∞ –ü–í–• d200', budget: '120 000 ‚Ç∏', time: '1 –¥–µ–Ω—å' },

                'other': { machine: '–ì—Ä—É–∑–æ–≤–∏–∫', mat: '–ë—Ä—É—Å—á–∞—Ç–∫–∞/–ö—Ä–∞—Å–∫–∞', budget: '50 000 ‚Ç∏', time: '5 —á–∞—Å–æ–≤' }

            };

            return dict[cat] || dict['other'];

        },



        // --- HELPERS ---

        updateRequestData: function(id, data, refresh) {

            const db = this.getRequests();

            const index = db.findIndex(r => r.id === id);

            if (index !== -1) {

                db[index] = { ...db[index], ...data };

                this.saveRequests(db);

                if (refresh) this.renderUI();

            }

        },



        toBase64: file => new Promise((resolve, reject) => {

            const reader = new FileReader();

            reader.readAsDataURL(file);

            reader.onload = () => resolve(reader.result);

            reader.onerror = error => reject(error);

        }),



        getStatusClass: function(s) {

            if (s === 'approved') return 'st-done';

            if (s === 'rejected') return 'st-reject';

            return 'st-process';

        },



        getStatusText: function(s) {

            if (s === 'approved') return '–û–¥–æ–±—Ä–µ–Ω–æ (–í —Ä–∞–±–æ—Ç–µ)';

            if (s === 'rejected') return '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ';

            return '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏';

        }

    };



    // –°—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

    window.addEventListener('DOMContentLoaded', () => App.init());



</script>

</body>

</html>   –¥–æ–±–∞–≤—å –≤ —ç—Ç–æ—Ç –∫–æ–¥ –Ω–∞ –≥–∏—Ö–∞–±–µ —ç—Ç–∏ —É—Å–ª–æ–≤–∏—è –ù–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã:

new

approved

contractor_proposed

proposal_accepted

rejected

–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –∑–∞—è–≤–∫–µ:

contractorProposal: {

    amount,

    comment,

    date,

    status   // pending / accepted / revision

}

üß† 1Ô∏è‚É£ –û–ë–ù–û–í–õ–Ø–ï–ú AI –õ–û–ì–ò–ö–£ –°–ú–ï–¢–´



–ó–∞–º–µ–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é aiSimulateDamage –Ω–∞ –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—É—é:

aiSimulateDamage: function(cat) {

    const base = {

        'roads': { min: 350000, max: 600000, machine: '–ê—Å—Ñ–∞–ª—å—Ç–æ—É–∫–ª–∞–¥—á–∏–∫, –ö–∞—Ç–æ–∫', mat: '–ê—Å—Ñ–∞–ª—å—Ç, –ë–∏—Ç—É–º' },

        'lights': { min: 60000, max: 120000, machine: '–ê–≤—Ç–æ–≤—ã—à–∫–∞', mat: 'LED –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä, –ö–∞–±–µ–ª—å' },

        'trash': { min: 10000, max: 25000, machine: '–ú—É—Å–æ—Ä–æ–≤–æ–∑', mat: '‚Äî' },

        'water': { min: 90000, max: 180000, machine: '–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä', mat: '–¢—Ä—É–±—ã –ü–í–•, –ú—É—Ñ—Ç—ã' },

        'other': { min: 30000, max: 100000, machine: '–ì—Ä—É–∑–æ–≤–∏–∫', mat: '–°—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã' }

    };



    const cfg = base[cat] || base['other'];

    const budget = Math.floor(Math.random() * (cfg.max - cfg.min) + cfg.min);



    return {

        machinery: cfg.machine,

        materials: cfg.mat,

        budgetAI: budget,

        formattedBudget: budget.toLocaleString('ru-RU') + ' ‚Ç∏',

        time: Math.floor(Math.random() * 3) + 1 + ' –¥–Ω—è'

    };

},

üë∑ 2Ô∏è‚É£ –ü–û–õ–ù–û–°–¢–¨–Æ –ù–û–í–ê–Ø renderWorkerFeed()



–ó–∞–º–µ–Ω–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–¥—Ä—è–¥—á–∏–∫–∞:

renderWorkerFeed: function() {

    const db = this.getRequests();

    const todoList = db.filter(r => 

        r.status === 'approved' || 

        r.status === 'contractor_proposed'

    );



    const container = document.getElementById('worker-feed');



    if (todoList.length === 0) {

        container.innerHTML = '<p style="text-align:center">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫.</p>';

        return;

    }



    container.innerHTML = todoList.map(r => {



        if (!r.workerData) {

            r.workerData = this.aiSimulateDamage(r.category);

            this.updateRequestData(r.id, { workerData: r.workerData }, false);

        }



        const proposal = r.contractorProposal || {};



        return `

        <div class="card card-worker">

            <h3>–ù–∞—Ä—è–¥ ‚Ññ${r.id}</h3>

            <p><b>–ê–¥—Ä–µ—Å:</b> ${r.address}</p>

            <p>${r.desc}</p>



            <div class="ai-panel" style="border-color:#00b894; background:#f0fff4;">

                <span class="ai-badge" style="background:#00b894">AI –°–º–µ—Ç–∞</span>

                <div class="ai-content">

                    <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã:</b><br>

                    ‚Ä¢ –¢–µ—Ö–Ω–∏–∫–∞: ${r.workerData.machinery}<br>

                    ‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: ${r.workerData.materials}<br>

                    ‚Ä¢ –ü—Ä–æ–≥–Ω–æ–∑ –±—é–¥–∂–µ—Ç–∞: 

                    <b style="font-size:15px">${r.workerData.formattedBudget}</b><br>

                    ‚Ä¢ –°—Ä–æ–∫: ${r.workerData.time}

                </div>

            </div>



            <div style="margin-top:15px; border-top:1px solid #eee; padding-top:15px;">

                <label>–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–≤–æ—é —Å—É–º–º—É (‚Ç∏)</label>

                <input type="number" id="offer-${r.id}" 

                    value="${proposal.amount || r.workerData.budgetAI}" />



                <label style="margin-top:10px">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–¥—Ä—è–¥—á–∏–∫–∞</label>

                <textarea id="offer-comment-${r.id}" rows="2"

                placeholder="–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏...">${proposal.comment || ''}</textarea>



                <button class="btn-primary"

                    style="margin-top:10px; background:#0984e3"

                    onclick="App.submitProposal(${r.id})">

                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ –ê–∫–∏–º–∞—Ç

                </button>



                ${

                    proposal.status === 'pending' ? 

                    `<div style="margin-top:10px; color:#f39c12;">

                        –û–∂–∏–¥–∞–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è –∞–∫–∏–º–∞—Ç–æ–º

                    </div>` : ''

                }



                ${

                    proposal.status === 'accepted' ?

                    `<div style="margin-top:10px; color:#27ae60;">

                        –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ. –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–∞–±–æ—Ç–µ.

                    </div>` : ''

                }

            </div>

        </div>

        `;

    }).join('');

},

üì® 3Ô∏è‚É£ –î–û–ë–ê–í–õ–Ø–ï–ú submitProposal()



–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é:

submitProposal: function(id) {

    const amount = document.getElementById(`offer-${id}`).value;

    const comment = document.getElementById(`offer-comment-${id}`).value;



    if (!amount) {

        alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É!');

        return;

    }



    const proposalData = {

        amount: parseInt(amount),

        comment: comment,

        date: new Date().toLocaleString('ru-RU'),

        status: 'pending'

    };



    this.updateRequestData(id, {

        contractorProposal: proposalData,

        status: 'contractor_proposed'

    }, true);



    alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ê–∫–∏–º–∞—Ç.');

},

üèõ 4Ô∏è‚É£ –î–û–ë–ê–í–õ–Ø–ï–ú –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –í –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò



–í–Ω—É—Ç—Ä–∏ renderAdminFeed() –¥–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ AI –ø–∞–Ω–µ–ª–∏:

${r.contractorProposal ? `

<div class="ai-panel" style="border-color:#0984e3; background:#eef6ff;">

    <span class="ai-badge" style="background:#0984e3">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞</span>

    <div class="ai-content">

        <b>–°—É–º–º–∞:</b> ${r.contractorProposal.amount.toLocaleString('ru-RU')} ‚Ç∏<br>

        <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> ${r.contractorProposal.comment}<br>

        <small>–î–∞—Ç–∞: ${r.contractorProposal.date}</small>



        ${

            r.contractorProposal.status === 'pending' ?

            `<div style="margin-top:10px;">

                <button class="btn-primary"

                    style="background:#27ae60"

                    onclick="App.acceptProposal(${r.id})">

                    –ü—Ä–∏–Ω—è—Ç—å

                </button>

                <button class="btn-primary"

                    style="background:#e74c3c"

                    onclick="App.revisionProposal(${r.id})">

                    –ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É

                </button>

            </div>`

            : ''

        }

    </div>

</div>

` : ''}

üèõ 5Ô∏è‚É£ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–î–ú–ò–ù–ê



–î–æ–±–∞–≤—å—Ç–µ:

acceptProposal: function(id) {

    this.updateRequestData(id, {

        status: 'proposal_accepted',

        contractorProposal: {

            ...this.getRequests().find(r => r.id === id).contractorProposal,

            status: 'accepted'

        }

    }, true);

},



revisionProposal: function(id) {

    this.updateRequestData(id, {

        status: 'approved',

        contractorProposal: {

            ...this.getRequests().find(r => r.id === id).contractorProposal,

            status: 'revision'

        }

    }, true);

},
